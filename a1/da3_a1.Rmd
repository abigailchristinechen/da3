---
title: "DA3-A1"
author: "Abigail Chen"
prettydoc::html_pretty:
    theme: cayman
    highlight: github
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# Clean environment
rm(list=ls())

# loading the libraries
# Load packages
library(tidyverse)
library(caret) 
library(ggplot2)
library(forecast)
library(flexmix)
library(ggstatsplot)
install.packages('ggstatsplot')
#preventing scientific notations
options(scipen=999)

```


# Introduction

For this assignment the goal is to use the parameters given in the dataset, [cps-earnings dataset](https://osf.io/g8p9j/), to build various kinds of predictive models using linear regression for hourly wage for **Editors**. The data is taken from Current Population Survey (CPS), which is a survey for the employment and labor markets. After data cleaning, parameters will be chosen with its relation to the parameter of interest. These will be tested in terms of (a) RMSE in the full sample, (b) BIC in the full sample and (c) cross-validated RMSE. Finally, then discussing the relationships between the different models and its performance.

# Data Cleaning, EDA and Transformation (see details in Appendix)

```{r, include=FALSE}
## Loading the data from the web 

df = read.csv( 'https://osf.io/4ay9x/download')

## Check the data table
glimpse(df)
```

## Selecting the occupation 
  
  Selected: Editors; 2830

```{r }
## Selecting the Editors with code : 2830
df = df[df$occ2012  == '2830' ,]

## Check the data table
glimpse(df)
```

## Data Cleaning 

## Check the structure of the data
```{r }
str(df)
```

## Parameters Selection
Initial checking of various parameters to try based on intuition, to see which parameters can affect the wage.

```{r }
df = df[, c('weight','earnwke', 'uhours', 'race', 'age', 'sex', 'marital','grade92', 'state','class','prcitshp')]
```

## Creating variable of interest: Hourly Wage 

```{r }
df$HourlyWage = round(df$earnwke/df$uhours)
```


## Parameters Selection:
Analyzing the different parameters initially chosen

## Weight

```{r }
weight_summary <- summary(df$weight)
weight_summary
## Min. 1st Qu.  Median    Mean   3rd Qu.    Max. 
## 222.1  1054.6  2769.5  2375.1  3427.1  7469.4 
```


```{r }
## Check weight graph
 ggplot(df, aes(x=weight, y=HourlyWage)) + geom_point()

```

Visualization shows a random spread.


```{r }
## Tried using Pearson Coefficient to see best fit for the various parameters
## https://statistics.laerd.com/statistical-guides/pearson-correlation-coefficient-statistical-guide.php
## https://libguides.library.kent.edu/spss/pearsoncorr
## used the guideline here to interpret the Pearson's correlation coefficient
## okay to try, since weight is continuous parameter
## tried the code chunk from https://www.reneshbedre.com/blog/correlation-analysis-r.html
cor(df$HourlyWage, df$weight, method = 'pearson')
## -0.1220714
```

Here, we can see using the pearson correlation that the weight has very low negative correlation to the hourly wage. 
So, it will not be considered as a predictor parameter. 

## Race 

```{r }
unique(df$race)

```

Converting the race variable to categorical variable.

```{r }

df$race = as.factor(df$race)

```



```{r }

race_box <- ggplot(df, aes(x=race, y=HourlyWage)) + 
  geom_boxplot()
race_box
```
In the visualization, the box plot clearly show there is difference in hourly wage for the different races.


```{r }
## https://www.scribbr.com/statistics/anova-in-r/
## since category
Anova_Race <- aov(HourlyWage ~ race, data = df)

summary(Anova_Race)

```

The Anova test confirms that there is difference of hourly wage on the basis of race. However, it is not very significant as the P value is greater than the usual threshold of 0.05. Nonetheless, race will be used as a predictor cause there is relation between hourly wage and race.









